function stripeResponseHandler(e,d){if(200!=e)return alert("Something went wrong: "+d.error.message+"\nYou weren't charged."),resetAddCredits(!1),!1;var t=d.id;$("#stripeToken").val(t),$("#newCredits").val(),$("#userID").val();var i=$("#new_charge").serialize();$.ajax({url:"/charges",type:"POST",dataType:"JSON",data:i,success:function(e){dismissAddCreditsModal();var d=e.credits;$("#credits").html("$"+(d/100).toFixed(2)),$("#credits").data("credits",d),$("#credits").addClass("Highlight"),setTimeout(function(){$("#credits").removeClass("Highlight")},250)},complete:function(){resetAddCredits(!0)}})}function resetAddCredits(e){$("#submitCredits").prop("disabled",!1),$("#submitCredits").css("display","inline-block"),$("#submitCreditsSpinner").css("display","none"),e&&$("#new_charge").find("input[type=text]").val("")}function dismissAddCreditsModal(){$("#backdrop").removeClass("In"),$("#addCredit").removeClass("In"),resetAddCredits(!0)}function keyCode(e){return e.keyCode?e.keyCode:e.which}function isNumberKey(e){return e>=48&&57>=e||8==e||13==e||e>=37&&40>=e}$("body").on("click","#addCredits",function(){var e=$("#newCredits").val();if(0==e.length||0==e)return!1;var e=parseInt(e,10),d="$"+(e/100).toFixed(2),t=function(e){var d=$("<input type=hidden name=stripeToken />").val(e.id);$("form").append(d).submit()};return StripeCheckout.open({key:"pk_test_iMhOgbsH06IanFKtsyoHW2zW",address:!0,amount:e,currency:"usd",name:"Add credits",description:d+" additional credit",panelLabel:"Checkout",token:t}),!1}),$("body").on("submit","#new_charge",function(){var e=$("#submitCredits");$(e).prop("disabled",!0),$(e).css("display","none"),$("#submitCreditsSpinner").css("display","inline-block");var d=$("#new_charge");return Stripe.createToken(d,stripeResponseHandler),!1}),$("body").on("click","#addCreditButton",function(){$("#backdrop").addClass("In"),$("#addCredit").addClass("In")}),$("body").on("click","#addCredit .ModalDismiss",dismissAddCreditsModal),$("body").on("keydown","#cardExpM",function(e){var d=keyCode(e);return isNumberKey(d)?void 0:(e.preventDefault(),!1)}),$("body").on("keyup","#cardExpM",function(){$(this).val().length>=2&&$("#cardExpY").focus()}),$("body").on("keydown","#cardExpY",function(e){var d=keyCode(e);return isNumberKey(d)?void 0:(e.preventDefault(),!1)});