function audio_target_loaded(){console.log("audio target load");var e=document.getElementById("audio_target").contentWindow.document.body.textContent;console.log("iframeText: "+e);var n=e.indexOf("window");-1!==n&&(console.log("Script found"),e=e.substring(0,n));var o=JSON.parse(e);$("#song_audio_id").val(o.audio_id)}function beginAlbumArtUpdate(){$("#albumImageDarken").css("opacity",1),$("#changeAlbumImageSpinner").css("display","inline-block"),$("#changeAlbumImageSpinner").addClass("Spinner")}function endAlbumArtUpdate(){$("#albumImageDarken").css("opacity",0),$("#changeAlbumImageSpinner").css("display","none"),$("#changeAlbumImageSpinner").removeClass("Spinner")}function album_target_loaded(){endAlbumArtUpdate();var e=JSON.parse(document.getElementById("album_target").contentWindow.document.body.textContent);$(".NewSongArt").attr("src",e.img_src),$("#song_album_art_id").val(e.img_id)}function hideNewSongFeedback(){$("#newSongFeedback").removeClass("alert-success"),$("#newSongFeedback").css("display","none")}function new_song_success(){console.log("Song created successfully"),$("#newSongFeedback").addClass("alert-success"),$("#newSongFeedback").slideDown()}function waitForMediaTargetToFinish(){setTimeout(function(){return $("#commentMediaTarget").contents().length>0?(mediaTargetDidFinishLoading(),void 0):void 0},250)}function mediaTargetDidFinishLoading(){var e=$("#commentMediaTarget").contents().find("body").html(),n=e.indexOf("}");console.log(e.slice(0,n+1));var o=$.parseJSON(e.slice(0,n+1)),t=o[Object.keys(o)[0]];console.log(t);var a=$("#comment_media_ids").val();a.length>0&&(a+=","),a+=t,console.log("curL: "+a),$("#comment_media_ids").val(a)}$("body").on("click","#clearGeneralFields",function(){return event.preventDefault(),$("#all_songs_song_name").val(""),$("#all_songs_song_album").val(""),$("#all_songs_song_track_number").val(""),!1}),$("#artistname").val(getArtistNameFromURL()),$(window).on("djaxLoad",function(){$("#artistname").val(getArtistNameFromURL())}),$("body").on("click","#select_file_button",function(){$("#audio_file").click()}),$("body").on("change","#audio_file",function(){var e=$(this).val().split("/").pop().split("\\").pop();$("#selectedFileName").text("'"+e+"' selected"),$("#new_audio").submit(),console.log("Matching name regex");var n,o,t=/^\d+ [^0-9-\s][^.]+/;t.test(e)&&(console.log("Match 1"),n=e.match(/[^0-9-\s][^.]+/)[0],o=e.match(/^\d+/)[0]),t=/^\d+\s?-\s?[^0-9-\s][^.]+/,t.test(e)&&(console.log("Match 2"),n=e.match(/[^0-9-\s][^.]+/)[0],o=e.match(/^\d+/)[0]),t=/^\d+\.\s?[^0-9-\s][^.]+/,t.test(e)&&(console.log("Match 3"),n=e.match(/[^0-9-\s][^.]+/)[0],o=e.match(/^\d+/)[0]),t=/Track \d+/,t.test(e)&&(o=e.match(/\d+/)[0]),t=/Track\s?-\s?\d+/,t.test(e)&&(o=e.match(/\d+/)[0]),t=/Song \d+/,t.test(e)&&(o=e.match(/\d+/)[0]),t=/Song\s?-\s?\d+/,t.test(e)&&(o=e.match(/\d+/)[0]),t=/[^0-9-\s][^.]+/,t.test(e)&&(n=e.match(t)[0]),console.log("songName: "+n+", trackNumber: "+o),o=o.replace(/^0+/,""),$("#song_name").val($.trim(n)),$("#song_track_number").val($.trim(o))}),$("#audio_target").load(function(){audio_target_loaded()}),$(window).bind("djaxLoad",function(){$("#audio_target").load(function(){audio_target_loaded()})});var suggestionImagePaths;$("body").on("keyup","#song_album",function(){if(console.log("song album keyup"),8==event.keyCode&&$(this).val().length<1)return $("#albumSuggestions").empty(),void 0;if(40!=event.keyCode&&38!=event.keyCode){var albumNameInput=$(this).val();$.ajax({url:"/json/album_name_suggestions",method:"POST",data:{input:albumNameInput},success:function(resp){var resp_json=eval(resp.names);suggestionImagePaths=eval(resp.paths),$("#albumSuggestions").empty();for(var i=0;i<resp_json.length;i++){var li="<li class='AlbumSuggestion' id='suggestion"+i+"'>"+resp_json[i]+"</li>";$("#albumSuggestions").append(li)}var textFieldTop=$("#song_album").position().top,textFieldHeight=$("#song_album").height();$("#albumSuggestions").css("top",textFieldHeight+textFieldTop+8+"px")}})}}),$("body").on("keydown","#song_album",function(){if(13==event.keyCode&&event.preventDefault(),40===event.keyCode||38===event.keyCode){var e=$(".SelectedSuggestion");if($(".SelectedSuggestion").each(function(){$(this).removeClass("SelectedSuggestion")}),40==event.keyCode){var n=-1;if(e.length){var o=$(e).attr("id").slice(10);n=parseInt(o,10)}n!==$(".AlbumSuggestion").length-1&&n++;var t="#suggestion"+n;$(t).addClass("SelectedSuggestion");var a=$(t).text();$("#song_album").val(a);var i=suggestionImagePaths[n];beginAlbumArtUpdate(),$(".NewSongArt").attr("src",i),event.preventDefault()}else if(38==event.keyCode){var n=-1;if(e.length){var o=$(e).attr("id").slice(10);n=parseInt(o,10)}n>0&&n--;var t="#suggestion"+n;$(t).addClass("SelectedSuggestion");var a=$(t).text();$("#song_album").val(a);var i=suggestionImagePaths[n];beginAlbumArtUpdate(),$(".NewSongArt").attr("src",i),event.preventDefault()}}}),$("body").on("blur","#song_album",function(){$("#albumSuggestions").empty()}),$("body").on("load",".NewSongArt",function(){endAlbumArtUpdate()}),$(window).bind("djaxLoad",function(){$(".NewSongArt").load(function(){})}),$("body").on("click","#newSongPreview",function(){$("#image_file").click()}),$("body").on("change","#image_file",function(){$("#new_image").submit()}),$("body").on("submit","#new_image",function(){beginAlbumArtUpdate()}),$("#album_target").load(function(){album_target_loaded()}),$(window).bind("djaxLoad",function(){$("#album_target").load(function(){album_target_loaded()})}),$("#new_song").bind("ajax:success",function(){new_song_success()}),$(window).bind("djaxLoad",function(){$("#new_song").bind("ajax:success",function(){new_song_success()})}),$("body").on("focus","#new_song > *",function(){hideNewSongFeedback()}),$("body").on("mouseout",".RelatedMedia",function(){$(".RelatedMediaCaption").removeClass("In")}),$("body").on("mouseover",".CommentSong",function(){$(".RelatedMediaCaption").addClass("In");var e=$(this).data("name"),n=$(this).data("creator");$(".RelatedMediaName").text(e),$(".RelatedMediaCreator").text(n)}),$("body").on("click",".CommentActionCollapse",function(){var e=$(this);$(e).css("display","none");var n=$(e).closest(".CommentContainer").first();$(n).children(".CommentContainer").slideUp(),$(e).parent().children(".CommentActionUncollapse").css("display","inline")}),$("body").on("click",".CommentActionUncollapse",function(){var e=$(this);$(e).css("display","none");var n=$(e).closest(".CommentContainer").first();$(n).children(".CommentContainer").slideDown(),$(e).parent().children(".CommentActionCollapse").css("display","inline")}),$("body").on("click",".CommentMediaOption",function(){var e="#"+$(this).data("field-id");$(e).click()}),$("body").on("change","#audio_file",function(){console.log("audio file changed"),$("#commentMediaAudio").addClass("Selected")}),$("body").on("change","#new_audio",function(){console.log("new audio submit"),waitForMediaTargetToFinish()}),$("body").on("change","#image_file",function(){console.log("image file changed"),$("#commentMediaImage").addClass("Selected")}),$("body").on("submit","#new_image",function(){console.log("new image submit"),waitForMediaTargetToFinish()}),$("body").on("change","#video_file",function(){console.log("video file changed"),$("#commentMediaVideo").addClass("Selected"),$("#new_video").submit()}),$("body").on("submit","#new_video",function(){console.log("new video submit"),waitForMediaTargetToFinish()});